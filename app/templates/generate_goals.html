{% include 'task-view-base.html' %}
{% block scripts %}
<script>
    var Scrollbar = window.Scrollbar;
    Scrollbar.init(document.querySelector('#subtasks'));
</script>
<script>
    // add click listeners to each goal card in order to chat with ChatGPT about the task and generate subtasks
    document.querySelectorAll('.goal-card').forEach(function (goalCard) {
        goalCard.addEventListener('click', function () {
            var taskId = goalCard.getAttribute('data-task-id');

            fetch('/demo/generate_subtasks/10', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    'task_id': taskId,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    // once the subtasks are generated, redirect to the new page
                    window.location.href = `/demo/display_subtasks/${taskId}`;
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        });
        document.addEventListener('DOMContentLoaded', function () {
            var loading = document.querySelector('.loading');

            goalCard.addEventListener('click', function () {
                loading.style.display = 'block';
            });
        });
    });
</script>
{% endblock %}
```